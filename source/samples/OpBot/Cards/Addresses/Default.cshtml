@using OpBot.Cards.Addresses
@inherits CardView<AddressesApp>

<Card Version="1.5">
    <TextBlock Size="ExtraLarge">Addresses</TextBlock>
    @if (App.Addresses.Any())
    {
        @foreach (var address in App.Addresses)
        {
            <Container Separator="true">
                <ColumnSet Padding="none">
                    <Column Width="stretch">
                        <TextBlock>@address.Street</TextBlock>
                        <TextBlock>@address.City, @address.State @address.PostalCode @address.Country</TextBlock>
                    </Column>
                    <Column Width="auto">
                        <Image Url="https://icons.iconarchive.com/icons/icons8/windows-8/72/Files-Edit-File-icon.png" Size="Small">
                            <SelectAction>
                                <Action.Execute Tooltip="Edit Address" Verb="OnEdit">
                                    { "resourceId":"@address.Id" }
                                </Action.Execute>
                            </SelectAction>
                        </Image>
                    </Column>
                    <Column Width="auto">
                        <Image Url="https://icons.iconarchive.com/icons/icons8/windows-8/72/Files-Delete-File-icon.png" Size="Small">
                            <SelectAction>
                                <Action.Execute Tooltip="Delete Address" Verb="OnDelete">
                                    { "resourceId":"@address.Id" }
                                </Action.Execute>
                            </SelectAction>
                        </Image>
                    </Column>
                </ColumnSet>
            </Container>
        }
    }
    else
    {
        <TextBlock>No addresses.</TextBlock>
    }
    <Action.Execute Title="Add Address" Verb="OnAdd" />
</Card>

@functions {

    public void OnAdd()
    {
        ShowCard("Add");
    }

    public void OnEdit(string resourceId)
    {
        var address = App.Addresses.SingleOrDefault(a => a.Id == resourceId);
        if (address != null)
        {
            ShowCard("Edit", address);
        }
    }

    public void OnDelete(string resourceId)
    {
        App.Addresses = App.Addresses.Where(a => a.Id != resourceId).ToList();
    }

    public void OnEditCompleted(Address editAddress)
    {
        ArgumentNullException.ThrowIfNull(editAddress);
        var address = App.Addresses.Where(a => a.Id == editAddress.Id).SingleOrDefault();
        if (address != null)
        {
            address.Street = editAddress.Street;
            address.City = editAddress.City;
            address.State = editAddress.State;
            address.PostalCode = editAddress.PostalCode;
            address.Country = editAddress.Country;
            AddBannerMessage("Address updated", AdaptiveContainerStyle.Good);
        }
        else
        {
            AddBannerMessage("Address not found", AdaptiveContainerStyle.Attention);
        }
    }

    public void OnAddCompleted(Address address)
    {
        ArgumentNullException.ThrowIfNull(address);
        App.Addresses.Add(address);
        AddBannerMessage("Address added", AdaptiveContainerStyle.Good);
    }

    public void OnCanceled(string? message)
    {
        if (!String.IsNullOrWhiteSpace(message))
        {
            AddBannerMessage(message, AdaptiveContainerStyle.Accent);
        }
    }
}