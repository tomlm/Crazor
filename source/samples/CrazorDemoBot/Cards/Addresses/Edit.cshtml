@using CrazorDemoBot.Cards.Addresses
@inherits CardView<AddressesApp, Address>

@* This card supports a deep link route *@
@attribute [Route("{addressId}")]
@functions {
    public override string GetRoute()
        => $"{this.Model.Id}";

    public void OnLoadRoute(string addressId)
        => this.Model = this.App?.Addresses.SingleOrDefault(a => a.Id == addressId)! ?? throw new CardRouteNotFoundException($"Address {addressId} not found");
}

<Card Version="1.5">
    <TextBlock Class="H1">Edit Address</TextBlock>

    <Input.Text Binding="Model.Street" />
    <Input.Text Binding="Model.City" />
    <Input.ChoiceSet Binding="Model.State" />
    <Input.Text Binding="Model.PostalCode" />
    <Input.ChoiceSet Binding="Model.Country" />

    <Action.Cancel />
    <Action.OK />
</Card>

@functions {
    public void OnOK()
    {
        if (IsModelValid)
        {
            var address = App.Addresses.Where(a => a.Id == Model.Id).SingleOrDefault();
            if (address != null)
            {
                address.Street = Model.Street;
                address.City = Model.City;
                address.State = Model.State;
                address.PostalCode = Model.PostalCode;
                address.Country = Model.Country;
                AddBannerMessage("Address updated", AdaptiveContainerStyle.Good);
                ReplaceCard("Detail", address);
            }
            else
            {
                AddBannerMessage("Address not found", AdaptiveContainerStyle.Attention);
            }
        }
    }
}