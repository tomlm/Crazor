@using CrazorDemoBot.Cards.Addresses
@inherits CardView<AddressesApp>

<Card Version="1.5">
    <TextBlock Size="ExtraLarge">Addresses</TextBlock>
    @if (App.Addresses.Any())
    {
        @foreach (var address in App.Addresses)
        {
            <Container Separator="true">
                <ColumnSet Padding="none">
                    <Column Width="stretch">
                        <TextBlock>@address.Street</TextBlock>
                        <TextBlock>@address.City, @address.State @address.PostalCode @address.Country</TextBlock>
                    </Column>
                    <Column Width="auto">
                        <Image Url="@UrlHelper.Content("~/images/EditIcon.png")" Size="Small">
                            <SelectAction>
                                <Action.Execute Tooltip="Edit Address" Verb="OnEdit">
                                    { "addressId":"@address.Id" }
                                </Action.Execute>
                            </SelectAction>
                        </Image>
                    </Column>
                    <Column Width="auto">
                        <Image Url="@UrlHelper.Content("~/images/DeleteIcon.png")" Size="Small">
                            <SelectAction>
                                <Action.Execute Tooltip="Delete Address" Verb="OnDelete">
                                    { "addressId":"@address.Id" }
                                </Action.Execute>
                            </SelectAction>
                        </Image>
                    </Column>
                </ColumnSet>
                <SelectAction>
                    <Action.Execute Verb="Detail">
                        { "addressId":"@address.Id" }
                    </Action.Execute>
                </SelectAction>
            </Container>
        }
    }
    else
    {
        <TextBlock>No addresses.</TextBlock>
    }
    <Action.Execute Title="Add Address" Verb="OnAdd" />
</Card>

@functions {

    public void OnAdd()
    {
        ShowCard("Add");
    }

    public void OnDetail(string addressId)
    {
        var address = App.GetAddress(addressId);
        if (address != null)
        {
            ShowCard("Detail", address);
        }
    }

    public void OnEdit(string addressId)
    {
        var address = App.GetAddress(addressId);
        if (address != null)
        {
            ShowCard("Edit", address);
        }
    }

    public void OnDelete(string addressId)
    {
        App.Addresses = App.Addresses.Where(a => a.Id != addressId).ToList();
    }


    public void OnCanceled(string? message)
    {
        if (!String.IsNullOrWhiteSpace(message))
        {
            AddBannerMessage(message, AdaptiveContainerStyle.Accent);
        }
    }
}