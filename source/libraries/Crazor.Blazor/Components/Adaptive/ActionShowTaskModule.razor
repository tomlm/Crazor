@using Crazor.Blazor.ComponentRenderer;
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@inherits ActionSubmit

<ac:Action.ShowTaskModule @attributes="@GetAttributes()">
    <CascadingValue Name="ParentItem" Value="@Item">@ChildContent</CascadingValue>
</ac:Action.ShowTaskModule>

@code
{
    private static JObject fetch = new JObject() { { "type", "task/fetch" } };

    /// <summary>
    /// The Card Route to show in a taskmodule, if not in teams this will be equivelent of navigating to a view.
    /// </summary>
    [Parameter]
    public string? Route { get; set; }

    protected override void OnAfterRender(bool firstRender)
    {
        base.OnAfterRender(firstRender);

        if (Route != null)
        {
            if (this.Item.Data == null)
                this.Item.Data = new JObject();

            var data = this.Item.Data as JObject;
            if (data != null)
            {
                data["msteams"] = fetch;
                data["commandId"] = Route;
            }
        }
    }
}
