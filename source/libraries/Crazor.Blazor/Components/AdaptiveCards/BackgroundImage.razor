@using global::AdaptiveCards
@using Crazor.Attributes;
@using Microsoft.AspNetCore.Components;
@using System.ComponentModel;
@using System.Xml.Linq;
@inherits ItemComponent<AdaptiveBackgroundImage>

<ac:BackgroundImage @attributes="@GetAttributes()">
    <CascadingValue Name="ParentModel" Value="@Model">@ChildContent</CascadingValue>
</ac:BackgroundImage>

@code
{
    [Parameter]
    [DefaultValue(typeof(AdaptiveImageFillMode), "Cover")]
    public AdaptiveImageFillMode FillMode { get => Model.FillMode; set => Model.FillMode = value; }

    [Parameter]
    [DefaultValue(typeof(AdaptiveHorizontalAlignment), "Left")]
    public AdaptiveHorizontalAlignment HorizontalAlignment { get => Model.HorizontalAlignment; set => Model.HorizontalAlignment = value; }

    [Parameter]
    public String Url { get => Model.Url; set => Model.Url = value; }

    [Parameter]
    [DefaultValue(typeof(AdaptiveVerticalAlignment), "Top")]
    public AdaptiveVerticalAlignment VerticalAlignment { get => Model.VerticalAlignment; set => Model.VerticalAlignment = value; }

    protected override void OnAfterRender(bool firstRender)
    {
        base.OnAfterRender(firstRender);

        ArgumentNullException.ThrowIfNull(ParentModel);
        if (ParentModel is AdaptiveCard card)
            card.BackgroundImage = this.Model;
        else if (ParentModel is AdaptiveContainer container)
            container.BackgroundImage = this.Model;
        else
            throw new Exception($"{ParentModel.GetType().Name} is not a valid parent for BackgroundImage");
    }
}
